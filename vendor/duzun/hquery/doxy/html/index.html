<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hQuery.php: hQuery.php   [![Build Status](https://travis-ci.org/duzun/hQuery.php.svg?branch=master)](https://travis-ci.org/duzun/hQuery.php)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hQuery.php
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="hQuery_8php_source.html">hQuery.php</a> [![Build Status](<a href="https://travis-ci.org/duzun/hQuery.php.svg?branch=master">https://travis-ci.org/duzun/hQuery.php.svg?branch=master</a>)](<a href="https://travis-ci.org/duzun/hQuery.php">https://travis-ci.org/duzun/hQuery.php</a>) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An extremely fast and efficient web scraper that parses megabytes of HTML in a blink of an eye.</p>
<p><a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html">API Documentation</a></p>
<h1>Features</h1>
<ul>
<li>Very fast parsing and lookup</li>
<li>Parses broken HTML</li>
<li>jQuery-like style of DOM traversal</li>
<li>Low memory usage</li>
<li>Can handle big HTML documents (I have tested up to 20Mb, but the limit is the amount of RAM you have)</li>
<li>Doesn't require cURL to be installed</li>
<li>Automatically handles redirects (301, 302, 303)</li>
<li>Caches response for multiple processing tasks</li>
<li>PHP 5.3+</li>
<li>No dependencies</li>
</ul>
<h1>Install</h1>
<p>Just &lsquo;include_once '<a class="el" href="hquery_8php_source.html">hquery.php</a>&rsquo;;<code>in your project and start using</code>hQuery`.</p>
<p>Alternatively <code>composer require duzun/hquery</code></p>
<p>or using <code>npm install <a class="el" href="hquery_8php_source.html">hquery.php</a></code>, &lsquo;require_once 'node_modules/hquery.php/hquery.php&rsquo;;`.</p>
<h1>Usage</h1>
<p>### Basic setup: </p><div class="fragment"><div class="line"><span class="comment">// Optionally use namespaces</span></div><div class="line">use <a class="code" href="namespaceduzun_1_1hQuery.html">duzun\hQuery</a>;</div><div class="line"></div><div class="line"><span class="comment">// Either use commposer, either include this file:</span></div><div class="line">include_once <span class="stringliteral">&#39;/path/to/libs/hquery.php&#39;</span>;</div><div class="line"></div><div class="line"><span class="comment">// Set the cache path - must be a writable folder</span></div><div class="line"><span class="comment">// If not set, hQuery::fromURL() whould make a new request on each call</span></div><div class="line">hQuery::$cache_path = <span class="stringliteral">&quot;/path/to/cache&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">// Time to keed request data in cache, seconds</span></div><div class="line"><span class="comment">// A value of 0 disables cahce</span></div><div class="line">hQuery::$cache_expires = 3600; <span class="comment">// default one hour</span></div></div><!-- fragment --><h3>Load HTML from a file</h3>
<h6><a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html#_fromFile">hQuery::fromFile</a>( string <code>$filename</code>, boolean <code>$use_include_path</code> = false, resource <code>$context</code> = NULL )</h6>
<div class="fragment"><div class="line"><span class="comment">// Local</span></div><div class="line">$doc = hQuery::fromFile(<span class="stringliteral">&#39;/path/to/filesystem/doc.html&#39;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Remote</span></div><div class="line">$doc = hQuery::fromFile(<span class="stringliteral">&#39;https://example.com/&#39;</span>, <span class="keyword">false</span>, $context);</div></div><!-- fragment --><p>Where <code>$context</code> is created with <a href="https://secure.php.net/manual/en/function.stream-context-create.php">stream_context_create()</a>.</p>
<p>For an example of using <code>$context</code> to make a HTTP request with proxy see <a href="https://github.com/duzun/hQuery.php/issues/26#issuecomment-351032382">#26</a>.</p>
<h3>Load HTML from a string</h3>
<h6><a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html#_fromHTML">hQuery::fromHTML</a>( string <code>$html</code>, string <code>$url</code> = NULL )</h6>
<div class="fragment"><div class="line">$doc = hQuery::fromHTML(<span class="stringliteral">&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;Sample HTML Doc&lt;/title&gt;&lt;body&gt;Contents...&lt;/body&gt;&lt;/html&gt;&#39;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Set base_url, in case the document is loaded from local source.</span></div><div class="line"><span class="comment">// Note: The base_url is used to retrive absolute URLs from relative ones</span></div><div class="line">$doc-&gt;base_url = <span class="stringliteral">&#39;http://desired-host.net/path&#39;</span>;</div></div><!-- fragment --><h3>Load a remote HTML document</h3>
<p>###### <a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html#_fromURL">hQuery::fromUrl</a>( string <code>$url</code>, array <code>$headers</code> = NULL, array|string <code>$body</code> = NULL, array <code>$options</code> = NULL ) </p><div class="fragment"><div class="line">use <a class="code" href="namespaceduzun_1_1hQuery.html">duzun\hQuery</a>;</div><div class="line"></div><div class="line"><span class="comment">// GET the document</span></div><div class="line">$doc = hQuery::fromUrl(<span class="stringliteral">&#39;http://example.com/someDoc.html&#39;</span>, [<span class="stringliteral">&#39;Accept&#39;</span> =&gt; <span class="stringliteral">&#39;text/html,application/xhtml+xml;q=0.9,*/*;q=0.8&#39;</span>]);</div><div class="line"></div><div class="line">var_dump($doc-&gt;headers); <span class="comment">// See response headers</span></div><div class="line">var_dump(hQuery::$last_http_result); <span class="comment">// See response details of last request</span></div><div class="line"></div><div class="line"><span class="comment">// with POST</span></div><div class="line">$doc = hQuery::fromUrl(</div><div class="line">    <span class="stringliteral">&#39;http://example.com/someDoc.html&#39;</span>, <span class="comment">// url</span></div><div class="line">    [<span class="stringliteral">&#39;Accept&#39;</span> =&gt; <span class="stringliteral">&#39;text/html,application/xhtml+xml;q=0.9,*/*;q=0.8&#39;</span>], <span class="comment">// headers</span></div><div class="line">    [<span class="stringliteral">&#39;username&#39;</span> =&gt; <span class="stringliteral">&#39;Me&#39;</span>, <span class="stringliteral">&#39;fullname&#39;</span> =&gt; <span class="stringliteral">&#39;Just Me&#39;</span>], <span class="comment">// request body - could be a string as well</span></div><div class="line">    [<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;POST&#39;</span>, <span class="stringliteral">&#39;timeout&#39;</span> =&gt; 7, <span class="stringliteral">&#39;redirect&#39;</span> =&gt; 7, <span class="stringliteral">&#39;decode&#39;</span> =&gt; <span class="stringliteral">&#39;gzip&#39;</span>] <span class="comment">// options</span></div><div class="line">);</div></div><!-- fragment --><p>For building advanced requests (POST, parameters etc) see <a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html#_http_wr">hQuery::http_wr()</a>, though I recomend using a specialized library for making requests and <code>hQuery::fromHTML($html, $url=NULL)</code> for processing results. See <a href="http://docs.guzzlephp.org/en/stable/">Guzzle</a> for eg.</p>
<p>Another option is to use <a href="https://secure.php.net/manual/en/function.stream-context-create.php">stream_context_create()</a> to create a <code>$context</code>, then call <code>hQuery::fromFile($url, false, $context)</code>.</p>
<h3>Processing the results</h3>
<p>###### <a href="https://duzun.github.io/hQuery.php/docs/class-hQuery.html#_find">hQuery::find</a>( string <code>$sel</code>, array|string <code>$attr</code> = NULL, hQuery_Node <code>$ctx</code> = NULL ) </p><div class="fragment"><div class="line"><span class="comment">// Find all banners (images inside anchors)</span></div><div class="line">$banners = $doc-&gt;find(<span class="stringliteral">&#39;a &gt; img:parent&#39;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Extract links and images</span></div><div class="line">$links  = array();</div><div class="line">$images = array();</div><div class="line">$titles = array();</div><div class="line"></div><div class="line"><span class="comment">// If the result of find() is not empty</span></div><div class="line"><span class="comment">// $banners is a collection of elements (hQuery_Element)</span></div><div class="line"><span class="keywordflow">if</span> ( $banners ) {</div><div class="line"></div><div class="line">    <span class="comment">// Iterate over the result</span></div><div class="line">    <span class="keywordflow">foreach</span>($banners as $pos =&gt; $a) {</div><div class="line">        $links[$pos] = $a-&gt;attr(<span class="stringliteral">&#39;href&#39;</span>); <span class="comment">// get absolute URL from href property</span></div><div class="line">        $titles[$pos] = trim($a-&gt;text()); <span class="comment">// strip all HTML tags and leave just text</span></div><div class="line"></div><div class="line">        <span class="comment">// Filter the result</span></div><div class="line">        <span class="keywordflow">if</span> ( !$a-&gt;hasClass(<span class="stringliteral">&#39;logo&#39;</span>) ) {</div><div class="line">            $img = $a-&gt;find(<span class="stringliteral">&#39;img&#39;</span>)[0]; <span class="comment">// ArrayAccess</span></div><div class="line">            <span class="keywordflow">if</span> ( $img ) $images[$pos] = $img-&gt;src; <span class="comment">// short for $img-&gt;attr(&#39;src&#39;)</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// If at least one element has the class .home</span></div><div class="line">    <span class="keywordflow">if</span> ( $banners-&gt;hasClass(<span class="stringliteral">&#39;home&#39;</span>) ) {</div><div class="line">        echo <span class="stringliteral">&#39;There is .home button!&#39;</span>, PHP_EOL;</div><div class="line"></div><div class="line">        <span class="comment">// ArrayAccess for elements and properties.</span></div><div class="line">        <span class="keywordflow">if</span> ( $banners[0][<span class="stringliteral">&#39;href&#39;</span>] == <span class="charliteral">&#39;/&#39;</span> ) {</div><div class="line">            echo <span class="stringliteral">&#39;And it is the first one!&#39;</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Read charset of the original document (internally it is converted to UTF-8)</span></div><div class="line">$charset = $doc-&gt;charset;</div><div class="line"></div><div class="line"><span class="comment">// Get the size of the document ( strlen($html) )</span></div><div class="line">$size = $doc-&gt;size;</div></div><!-- fragment --><h1>Live Demo</h1>
<p>On <a href="https://duzun.me/playground/hquery#sel=%20a%20%3E%20img%3Aparent&amp;url=https%3A%2F%2Fgithub.com%2Fduzun">DUzun.Me</a></p>
<p>A lot of people ask for sources of my <b>Live Demo</b> page. Here we go:</p>
<p><a href="https://github.com/duzun/hQuery.php/blob/master/examples/duzun.me_playground_hquery.php">view-source:https://duzun.me/playground/hquery</a></p>
<p>#TODO</p>
<ul>
<li>Unit tests everything</li>
<li>Document everything</li>
<li>~~Cookie support~~ (implemented in mem for redirects)</li>
<li>Use <a href="http://httplug.io/">HTTPlug</a> internally</li>
<li>Add more selectors</li>
<li>Improve selectors to be able to select by attributes</li>
</ul>
<h1>💖 Support my projects</h1>
<p>I love Open Source. Whenever possible I share cool things with the world (check out <a href="https://duzun.me/npm">NPM</a> and <a href="https://github.com/duzun/">GitHub</a>).</p>
<p>If you like what I'm doing and want to encorage me, please consider to:</p>
<ul>
<li>Star and Share the projects you like (and use)</li>
<li>Send me some <b>Bitcoin</b> at this addres: <code>bitcoin:3MVaNQocuyRUzUNsTbmzQC8rPUQMC9qafa</code> (or using the QR below) <div class="image">
<img src="https://cdn.duzun.me/files/qr_bitcoin-3MVaNQocuyRUzUNsTbmzQC8rPUQMC9qafa.png" alt="bitcoin:3MVaNQocuyRUzUNsTbmzQC8rPUQMC9qafa"/>
</div>
 </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
